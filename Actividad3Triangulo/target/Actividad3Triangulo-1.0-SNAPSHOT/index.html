<%@page contentType="text/html" pageEncoding="UTF-8" import="javax.servlet.http.Cookie"%>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Cálculo de Triángulo</title>
</head>
<body>
    <%
        // 1. Manejo de sesión para el nombre de usuario
        String nombreUsuario = (String) session.getAttribute("nombreUsuario");
        if (nombreUsuario == null) {
    %>
            <h1>¡Hola! Aún no te conozco.</h1>
            <p>Por favor, ingresa tu nombre para saludarte y guardarlo en la sesión.</p>
            <form action="ProcesarServlet" method="POST">
                <label for="nombre">Nombre:</label>
                <input type="text" id="nombre" name="nombre" required>
                <!-- Campos ocultos para base y altura, se procesarán en el servlet -->
                <input type="hidden" name="base" value="0">
                <input type="hidden" name="altura" value="0">
                <input type="submit" value="Guardar Nombre">
            </form>
    <%
        } else {
    %>
            <h1>¡Hola, <%= nombreUsuario %>!</h1>
            <p>Tus datos de sesión están activos.</p>
    <%
        }
    %>

    <%
        // 2. Manejo de cookies para el último cálculo
        String baseCookie = null;
        String alturaCookie = null;
        String areaCookie = null;
        String perimetroCookie = null;
        Cookie[] cookies = request.getCookies();
        if (cookies != null) {
            for (Cookie cookie : cookies) {
                switch (cookie.getName()) {
                    case "base":
                        baseCookie = cookie.getValue();
                        break;
                    case "altura":
                        alturaCookie = cookie.getValue();
                        break;
                    case "area":
                        areaCookie = cookie.getValue();
                        break;
                    case "perimetro":
                        perimetroCookie = cookie.getValue();
                        break;
                }
            }
        }

        if (baseCookie != null) {
    %>
            <h2>Último cálculo realizado (desde cookies):</h2>
            <p>Base: <%= baseCookie %></p>
            <p>Altura: <%= alturaCookie %></p>
            <p>Área: <%= areaCookie %></p>
            <p>Perímetro: <%= perimetroCookie %></p>
    <%
        }
    %>

    <!-- 3. Formulario para calcular el triángulo -->
    <h2>Calcula el área y perímetro de un triángulo equilátero:</h2>
    <form action="ProcesarServlet" method="POST">
        <label for="base">Base:</label>
        <input type="text" id="base" name="base" required><br>
        <label for="altura">Altura:</label>
        <input type="text" id="altura" name="altura" required><br>
        <% if (nombreUsuario != null) { %>
           <!-- Si el nombre ya está en sesión, lo enviamos oculto para no perderlo -->
           <input type="hidden" name="nombre" value="<%= nombreUsuario %>">
        <% } %>
        <input type="submit" value="Calcular">
    </form>
</body>
</html>